<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Магазин кроссовок</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
        h1 {
            text-align: center;
            margin: 20px 0;
        }
        .controls {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .controls select, .controls button {
            margin: 0 10px;
            padding: 10px;
            font-size: 16px;
        }
        .product-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .product {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 10px;
            background-color: #fff;
            width: 200px;
            text-align: center;
        }
        .product h3 {
            margin: 0 0 10px;
        }
        .product p {
            margin: 5px 0;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .cart {
            margin: 20px;
            padding: 20px;
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .cart h2 {
            margin: 0 0 10px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .cart-item span {
            margin-right: 10px;
        }
    </style>
</head>
<body>
<h1>Магазин кроссовок</h1>

<!-- Панель управления -->
<div class="controls">
    <select id="sort-brand">
        <option value="all">Все бренды</option>
        <option value="Nike">Nike</option>
        <option value="Adidas">Adidas</option>
        <option value="Puma">Puma</option>
        <option value="Reebok">Reebok</option>
        <option value="Converse">Converse</option>
    </select>
    <button onclick="sortProducts()">Сортировать</button>
</div>

<!-- Список товаров -->
<div id="product-list" class="product-list"></div>

<!-- Корзина -->
<div id="cart" class="cart">
    <h2>Корзина</h2>
    <div id="cart-items"></div>
    <h3>Общая сумма: <span id="total-price">0</span> USD</h3>
    <button onclick="checkout()">Оформить заказ</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // Расширяет WebApp

    // Пример товаров из API
    const products = [
        { id: 1, name: "Nike Air Max", price: 120.50, brand: "Nike" },
        { id: 2, name: "Adidas Ultraboost", price: 140.00, brand: "Adidas" },
        { id: 3, name: "Converse Classic", price: 80.00, brand: "Converse" },
        { id: 4, name: "Puma Future Rider", price: 95.99, brand: "Puma" },
        { id: 5, name: "Reebok Classic", price: 75.00, brand: "Reebok" },
        { id: 6, name: "Nike Revolution", price: 59.99, brand: "Nike" }
    ];

    let cart = [];

    // Функция отображения списка товаров
    function displayProducts(filter = "all") {
        const productList = document.getElementById("product-list");
        productList.innerHTML = "";

        const filteredProducts = filter === "all" ? products : products.filter(p => p.brand === filter);

        filteredProducts.forEach(product => {
            const item = document.createElement("div");
            item.className = "product";
            item.innerHTML = `
                    <h3>${product.name}</h3>
                    <p>Бренд: ${product.brand}</p>
                    <p>Цена: ${product.price.toFixed(2)} USD</p>
                    <button onclick="addToCart(${product.id})">Добавить в корзину</button>
                `;
            productList.appendChild(item);
        });
    }

    // Функция добавления товара в корзину
    function addToCart(productId) {
        const product = products.find(p => p.id === productId);
        if (!cart.some(item => item.id === productId)) {
            cart.push({ ...product, quantity: 1 });
        } else {
            cart = cart.map(item => item.id === productId ? { ...item, quantity: item.quantity + 1 } : item);
        }
        updateCart();
    }

    // Функция удаления товара из корзины
    function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        updateCart();
    }

    // Функция обновления корзины
    function updateCart() {
        const cartItems = document.getElementById("cart-items");
        const totalPrice = document.getElementById("total-price");
        cartItems.innerHTML = "";

        let total = 0;

        cart.forEach(item => {
            total += item.price * item.quantity;
            const cartItem = document.createElement("div");
            cartItem.className = "cart-item";
            cartItem.innerHTML = `
                    <span>${item.name} (${item.quantity} шт.) - ${item.price.toFixed(2)} USD</span>
                    <button onclick="removeFromCart(${item.id})">Удалить</button>
                `;
            cartItems.appendChild(cartItem);
        });

        totalPrice.innerText = total.toFixed(2);
    }

    // Функция сортировки товаров по бренду
    function sortProducts() {
        const brandFilter = document.getElementById("sort-brand").value;
        displayProducts(brandFilter);
    }

    // Функция оформления заказа
    function checkout() {
        const total = document.getElementById("total-price").innerText;
        const orderDetails = {
            products: cart,
            total: total
        };

        tg.sendData(JSON.stringify(orderDetails)); // Отправить данные в бота
        alert("Заказ отправлен! Спасибо за покупку.");
        cart = [];
        updateCart();
    }

    // Инициализация отображения товаров
    displayProducts();
</script>
</body>
</html>
